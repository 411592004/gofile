<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf8" />
    <title>gofile</title>
    <link rel="stylesheet" href="./bootstrap-3.3.7/css/bootstrap.min.css">
    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type="text/javascript" src="./bootstrap-3.3.7/js/bootstrap.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" style="background-color: #009966;">
        <div class="container navbar-left">
            <div class="navbar-header">
                <!--<a class="navbar-brand " href="#">
                        <img src="img/rtlogo.png" width="25px" height="25px" onclick="menu()">
                    </a>-->
                <text class="navbar-text" style="color: white;font-size: 20px;">gofile文件管理器</text>
                <text id="linkStat" class="navbar-text" style="color: white;font-size: 20px;"></text>
            </div>
        </div>
    </nav>
    <div id="contentDis " style="padding-top: 100px; margin-left: 20px">
        <div class="row">
            <div class="col-sm-4">
                <label for="inputCode">串口号:</label>
                <input type="text" id="comNum" placeholder="" value="com1">
            </div>
            <div class="col-sm-4">
                <label for="inputCode">波特率:</label>
                <input id="baudrate" value="115200">
            </div>
            <div class="col-sm-4">
                <button class=" btn btn-default " type="button" id="btnComOpen">打开</button>
                <button class=" btn btn-default " type="button" id="btnComClose">关闭</button>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-sm-4">
                <label for="inputCode">服务器地址:</label>
                <input type="text" id="codeid" placeholder="" value="127.0.0.1">
            </div>
            <div class="col-sm-4">
                <label for="inputCode">服务器端口号:</label>
                <input id="date" value="9000">
            </div>
            <div class="col-sm-4">
                <button class=" btn btn-default " type="button" id="btnset">连接</button>
                <button class=" btn btn-default " type="button" id="btnset">断开</button>
            </div>
        </div>
        <hr>
        <button class=" btn btn-default " type="button" id="btnlist">刷新</button>
        <hr />
        <div class="row">
            <div class="col-sm-3">
                <input id="uploadpath" type="text" name="">
            </div>
            <div class="col-sm-6">
                <button class=" btn btn-default " type="button" id="btnselect">选择</button>
                <button class=" btn btn-default " type="button" id="btnupload">上传</button>
            </div>
        </div>
        <hr />
        <div class="row">
            <div class="col-sm-3">
                <input type="text" id="downloadname" name="">
            </div>
            <div class="col-sm-6">
                <button class=" btn btn-default " type="button" id="btndownselect">选择</button>
                <button class=" btn btn-default " type="button" id="btndownload">下载</button>
            </div>
        </div>
    </div>
</body>
<!-- Modal -->
<div class="modal fade" id="selectModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="mySelectModalLabel">打开文件</h4>
            </div>
            <div class="modal-body">
                <div class="pre-scrollable">
                    <ul class="list-group" id="filesgroup" style="list-style-type:none">
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-sm-6">
                        文件名：<em id="selectdis"></em>
                    </div>
                    <div class="col-sm-6">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="btnPageup">向上</button>
                        <button id="btnfileopen" type="button" class="btn btn-primary">打开</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="selectdownModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">打开文件</h4>
            </div>
            <div class="modal-body">
                <div class="pre-scrollable">
                    <ul class="list-group" id="downfilesgroup" style="list-style-type:none">
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-sm-6">
                        文件名：<em id="selectdowndis"></em>
                    </div>
                    <div class="col-sm-6">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="btndownPageup">向上</button>
                        <button id="btndownfileopen" type="button" class="btn btn-primary">打开</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
var selectname = "";
$(document).ready(function() {

    $('#filesgroup').on("click", "li", function() {
        $('#filesgroup').find('li').css('background-color', 'white');
        $(this).css('background-color', '#e2f5ff');
        console.log($(this).text());
        selectname = $(this).text();
        $('#selectdis').text(selectname);

    })

    $('#downfilesgroup').on("click", "li", function() {
        $('#downfilesgroup').find('li').css('background-color', 'white');
        $(this).css('background-color', '#e2f5ff');
        console.log($(this).text());
        selectname = $(this).text();
        $('#selectdowndis').text(selectname);

    })
});

//browser files
$('#btnfileopen').click(async function() {
    isdir = await browsecurpath(selectname);
    if ((isdir == 0)||(isdir == 3)) {

    } else if(isdir == 1) {
        $('#uploadpath').val(selectname);
        $('#selectModal').modal('hide');

    }

});

$('#btnPageup').click(async function(){
	await browseruppage();
});

$('#btndownfileopen').click(function() {
    $('#downloadname').val(selectname);
    $('#selectdownModal').modal('hide');
});

$('#btnComOpen').click(async function() {

    Comnum = $('#comNum').val();
    Baudrate = parseInt($('#baudrate').val(), 10);

    ok = await opencom(Comnum, Baudrate)
    if (ok) {
        alert('打开串口成功');
    } else {

        alert('打开串口失败');
    }

});

$('#bntlist').click(async function() {
    console.log('btnlist:');
    await list();
});

$('#btnComClose').click(function() {
    console.log('btnclose');

});

$('#btnselect').click(async function() {
    $('#selectModal').modal();
    await browsecurpath("");
});

$('#btnupload').click(async function() {

    console.log('btnupload');
    await upload(selectname);
});



$('#btndownload').click(async function() {
    name = $('#downloadname').val();
    console.log('btndownload', name);
    await download(name);
});

//*************download********************
$('#btndownselect').click(async function(event) {
    $("#selectdownModal").modal();
    await browsedowncurpath();
});
</script>

</html>